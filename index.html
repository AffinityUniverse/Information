<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>í´ë˜ìŠ¤ ì•ˆë‚´ ë¬¸êµ¬ ìë™ ìƒì„±ê¸°</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#121a2a; --muted:#7f8aa3; --text:#e8eefc;
      --accent:#6aa6ff; --line:#23304a; --good:#79e2a6; --warn:#ffd36a; --bad:#ff7b9e;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, #16213a 0%, var(--bg) 45%) fixed;
      color:var(--text);
    }
    header{padding:22px 18px 10px; max-width:1180px; margin:0 auto;}
    h1{margin:0 0 6px; font-size:20px; font-weight:800; letter-spacing:-0.2px}
    .sub{color:var(--muted); font-size:13px; line-height:1.4}
    main{max-width:1180px; margin:0 auto; padding:14px 18px 34px}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:14px;}
    @media (max-width: 980px){ .grid{grid-template-columns: 1fr} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
      border:1px solid rgba(255,255,255,0.08);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
    }
    .card h2{margin:0 0 12px; font-size:15px; font-weight:800}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px}
    .row3{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:10px}
    @media (max-width: 560px){ .row, .row3{grid-template-columns:1fr} }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      background: rgba(10,14,24,0.6);
      border:1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      padding:10px 11px;
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(106,166,255,0.55);
      box-shadow: 0 0 0 4px rgba(106,166,255,0.15);
    }
    textarea{min-height: 520px; resize: vertical; line-height:1.5; white-space:pre-wrap; font-size:13px;}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      border:0; cursor:pointer; user-select:none;
      padding:10px 12px; border-radius: 12px;
      font-weight:800; font-size:13px;
      color:#07101f;
      background: linear-gradient(180deg, #8cc0ff 0%, #5c9cff 100%);
    }
    button.secondary{
      color:var(--text);
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
    }
    button.danger{
      color:var(--text);
      background: rgba(255,123,158,0.10);
      border:1px solid rgba(255,123,158,0.35);
    }
    button:active{transform: translateY(1px)}
    .note{margin-top:10px; font-size:12px; color:var(--muted); line-height:1.5;}
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color: var(--text);
    }
    .status{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .topbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:12px;}
    .warn{color:var(--warn)} .ok{color:var(--good)} .bad{color:var(--bad)} .muted{color:var(--muted)}
    .small{font-size:12px}
    .divider{height:1px; background:rgba(255,255,255,0.08); margin:12px 0}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .inline{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .list{
      background: rgba(10,14,24,0.35);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 10px;
    }
    .checkboxRow{
      display:flex; gap:8px; align-items:flex-start;
      padding:6px 0;
      border-bottom: 1px dashed rgba(255,255,255,0.08);
    }
    .checkboxRow:last-child{border-bottom:0}
    .checkboxRow input{width:auto; margin-top:3px}
    .tag{
      display:inline-block; padding:2px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color: var(--muted);
      font-size: 11px;
      margin-left:6px;
    }
  </style>
</head>
<body>
<header>
  <div class="topbar">
    <div>
      <h1>ì•ˆë‚´ë©”ì‹œì§€ ìë™ ìƒì„±ê¸°</h1>
      <div class="sub">ì˜µì…˜/ì¼ì • ì…ë ¥ â†’ <b>í˜„ì§€ ì‹œê°„(ìš”ì¼ í¬í•¨) ìë™ ê³„ì‚°</b> â†’ ìµœì¢… ë¬¸êµ¬ <b>í•œ ë²ˆì— ë³µì‚¬</b></div>
    </div>
    <div class="status">
      <span class="pill">ğŸ‡°ğŸ‡· í•œêµ­ì‹œê°„ ê¸°ì¤€</span>
      <span id="tzBadge" class="pill muted">í•´ì™¸ ì„¤ì • ì‹œ í˜„ì§€ì‹œê°„(ìš”ì¼ í¬í•¨) ìë™ í‘œì‹œ</span>
    </div>
  </div>
</header>

<main class="grid">
  <section class="card">
    <h2>ì…ë ¥</h2>

    <div class="row">
      <div>
        <label for="studentName">ì´ë¦„ ì…ë ¥(í•„ìˆ˜)</label>
        <input id="studentName" type="text" placeholder="ì˜ˆ: ë¯¼ì§€" />
      </div>
      <div>
        <label for="enrollType">ì‹ ê·œ / ì—°ì¥</label>
        <select id="enrollType">
          <option value="NEW">ì‹ ê·œ</option>
          <option value="RENEW">ì—°ì¥</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="familyType">ì™¸ë™ / í˜•ì œ</label>
        <select id="familyType">
          <option value="ONLY">ì™¸ë™</option>
          <option value="SIBLINGS">í˜•ì œ</option>
        </select>
      </div>
      <div>
        <label for="classType">1:1 / ê·¸ë£¹</label>
        <select id="classType">
          <option value="ONE_ON_ONE">1:1</option>
          <option value="GROUP">ê·¸ë£¹</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="startDay">í´ë˜ìŠ¤ ì‹œì‘ì¼(í•„ìˆ˜)</label>
        <input id="startDay" type="date" />
      </div>
      <div>
        <label for="endDay">í´ë˜ìŠ¤ ì¢…ë£Œì¼(í•„ìˆ˜)</label>
        <input id="endDay" type="date" />
      </div>
    </div>

    <div class="row3">
      <div>
        <label for="weekday">ì •ê¸° ìˆ˜ì—… ìš”ì¼</label>
        <select id="weekday">
          <option value="ì›”">ì›”</option><option value="í™”">í™”</option><option value="ìˆ˜">ìˆ˜</option>
          <option value="ëª©">ëª©</option><option value="ê¸ˆ">ê¸ˆ</option>
          <option value="í† ">í† </option><option value="ì¼">ì¼</option>
        </select>
      </div>
      <div>
        <label for="amPm">ì˜¤ì „ / ì˜¤í›„</label>
        <select id="amPm">
          <option value="ì˜¤ì „">ì˜¤ì „</option>
          <option value="ì˜¤í›„">ì˜¤í›„</option>
        </select>
      </div>
      <div>
        <label for="korTime">í•œêµ­ì‹œê°„ (ì˜ˆ: 7 / 7:30)</label>
        <input id="korTime" type="text" placeholder="ì˜ˆ: 7 / 7:30" />
      </div>
    </div>

    <div class="row">
      <div>
        <label for="studentLocation">êµ­ë‚´ / í•´ì™¸</label>
        <select id="studentLocation">
          <option value="DOMESTIC">êµ­ë‚´</option>
          <option value="OVERSEAS">í•´ì™¸</option>
        </select>
      </div>
      <div>
        <label for="dstMode">ì¸ë¨¸íƒ€ì„ ì˜µì…˜</label>
        <select id="dstMode">
          <option value="AUTO">ìë™(í‘œê¸° ì—†ìŒ)</option>
          <option value="STUDENT_CHANGE">ì¸ë¨¸íƒ€ì„ ë•Œ ìˆ˜ê°•ìƒ ì‹œê°„ ë³€ê²½</option>
          <option value="TEACHER_CHANGE">ì¸ë¨¸íƒ€ì„ ë•Œ ê°•ì‚¬ë§Œ ë°”ë€œ</option>
        </select>
        <div class="note small">â€» ê³„ì‚°ì€ ìë™ ë°˜ì˜ë©ë‹ˆë‹¤. ì˜µì…˜ì— ë”°ë¼ â€œë³€ê³¡ì  ì•ˆë‚´ ë¬¸êµ¬â€ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div id="overseasBox" style="display:none">
      <div class="divider"></div>
      <h2 style="margin-top:0">í•´ì™¸ ìˆ˜ê°•ìƒ ì„¤ì •</h2>

      <div class="row">
        <div>
          <label for="countryInput">êµ­ê°€(í•œêµ­ì–´) ê²€ìƒ‰</label>
          <input id="countryInput" list="countryList" placeholder="ì˜ˆ: ë¯¸êµ­, ìºë‚˜ë‹¤, í˜¸ì£¼..." />
          <datalist id="countryList"></datalist>
          <div class="note small">
            êµ­ê°€ ì„ íƒ í›„, êµ­ê°€ ë‚´ë¶€ ì‹œì°¨ê°€ ìˆìœ¼ë©´ ì‹œê°„ëŒ€ë¥¼ ê¼­ ì •í™•íˆ ê³¨ë¼ì£¼ì„¸ìš”.
          </div>
        </div>
        <div>
          <label for="customFlag">êµ­ê¸°(ì„ íƒ)</label>
          <input id="customFlag" type="text" placeholder="ì˜ˆ: ğŸ‡ºğŸ‡¸ (ë¹„ì›Œë‘ë©´ ìë™/ì—†ìœ¼ë©´ ìƒëµ)" />
        </div>
      </div>

      <div id="usStateBox" style="display:none">
        <div class="row">
          <div>
            <label for="usStateSelect">ë¯¸êµ­ ì£¼ ì„ íƒ</label>
            <select id="usStateSelect"></select>
            <div class="note small">
              ì¼ë¶€ ì£¼ëŠ” ì‹œê°„ëŒ€ê°€ 2ê°œ ì´ìƒì´ë¼, ì£¼ ì„ íƒ í›„ ì‹œê°„ëŒ€ì—ì„œ ì •í™•íˆ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.
            </div>
          </div>
          <div>
            <label for="usTzHint">ë¯¸êµ­ ë‚´ë¶€ ì‹œì°¨ ì•ˆë‚´</label>
            <input id="usTzHint" type="text" readonly value="ì£¼ ì„ íƒ â†’ ì‹œê°„ëŒ€ ìë™/ì¶”ì²œ" />
          </div>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="tzSelect">ì‹œê°„ëŒ€ ì„ íƒ(ê°€ì¥ ì¤‘ìš”)</label>
          <select id="tzSelect"></select>
          <div class="note small">
            í˜„ì§€ ìš”ì¼/ì‹œê°„ì€ <b>ê° ìˆ˜ì—…ì¼ ê¸°ì¤€</b>ìœ¼ë¡œ ê³„ì‚°ë˜ë©°, DST ë³€ê³¡ì ì´ ìˆìœ¼ë©´ ìë™ ê°ì§€ë©ë‹ˆë‹¤.
          </div>
        </div>
        <div>
          <label for="tzSearch">ì‹œê°„ëŒ€ ì§ì ‘ ê²€ìƒ‰(ì „ ì„¸ê³„)</label>
          <input id="tzSearch" placeholder="ì˜ˆ: America/Chicago, Europe/London, Asia/Singapore" />
          <div class="note small">êµ­ê°€ ë‚´ë¶€ ì‹œì°¨ êµ­ê°€ë„ ì‹œê°„ëŒ€ ì§ì ‘ ì„¤ì •ìœ¼ë¡œ ì „ë¶€ ì»¤ë²„ë©ë‹ˆë‹¤.</div>
        </div>
      </div>

      <div class="inline">
        <button id="applyTzSearch" class="secondary" type="button">ê²€ìƒ‰í•œ ì‹œê°„ëŒ€ë¡œ ì„¤ì •</button>
        <span class="pill" id="localPreviewPill">í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: -</span>
      </div>
    </div>

    <div class="divider"></div>

    <h2 style="margin-top:0">íœ´ê°•ì¼(ìˆ˜ë™ + ìë™ ê³µíœ´ì¼)</h2>

    <div class="row">
      <div>
        <label for="closedDate">íœ´ê°•ì¼ ë‚ ì§œ(ìˆ˜ë™ ì¶”ê°€)</label>
        <input id="closedDate" type="date" />
      </div>
      <div>
        <label for="closedNamePreset">íœ´ì¼ ëª…ì¹­(í”„ë¦¬ì…‹)</label>
        <select id="closedNamePreset">
          <option value="">ì§ì ‘ ì…ë ¥</option>
          <option value="ì„ì‹œíœ´ë¬´">ì„ì‹œíœ´ë¬´</option>
          <option value="ê³µíœ´ì¼">ê³µíœ´ì¼</option>
          <option value="ìƒˆí•´">ìƒˆí•´</option>
          <option value="ì‹ ì •">ì‹ ì •</option>
          <option value="ì„¤ ì—°íœ´">ì„¤ ì—°íœ´</option>
          <option value="ì‚¼ì¼ì ˆ">ì‚¼ì¼ì ˆ</option>
          <option value="ì–´ë¦°ì´ë‚ ">ì–´ë¦°ì´ë‚ </option>
          <option value="ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ">ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ </option>
          <option value="í˜„ì¶©ì¼">í˜„ì¶©ì¼</option>
          <option value="ê´‘ë³µì ˆ">ê´‘ë³µì ˆ</option>
          <option value="ì¶”ì„ ì—°íœ´">ì¶”ì„ ì—°íœ´</option>
          <option value="ê°œì²œì ˆ">ê°œì²œì ˆ</option>
          <option value="í•œê¸€ë‚ ">í•œê¸€ë‚ </option>
          <option value="í¬ë¦¬ìŠ¤ë§ˆìŠ¤">í¬ë¦¬ìŠ¤ë§ˆìŠ¤</option>
          <option value="ë…¸ë™ì ˆ">ë…¸ë™ì ˆ</option>
        </select>

        <input id="closedName" type="text" placeholder="ì§ì ‘ ì…ë ¥ ì‹œ ì—¬ê¸°ì— ì‘ì„± (ì„ íƒ)" style="margin-top:8px" />
        <div class="note small">í”„ë¦¬ì…‹ ì„ íƒ ì‹œ ìë™ ì…ë ¥ë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="btns" style="margin-top:0">
      <button id="addClosed" class="secondary" type="button">íœ´ê°•ì¼ ì¶”ê°€</button>
      <button id="clearClosed" class="danger" type="button">íœ´ê°•ì¼ ì „ì²´ ì‚­ì œ</button>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div>
        <label>í•œêµ­ ê³µíœ´ì¼ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°</label>
        <div class="inline">
          <button id="fetchHolidays" class="secondary" type="button">ê¸°ê°„ ë‚´ ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <span class="pill"><span class="tag">API</span> Nager.Date (ë¬´ë£Œ)</span>
        </div>
        <div class="note small">
          ì‹œì‘~ì¢…ë£Œ ê¸°ê°„ ì‚¬ì´ì˜ í•œêµ­ ê³µíœ´ì¼ì„ ê°€ì ¸ì™€ â€œì²´í¬ëœ í•­ëª©â€ë§Œ íœ´ê°•ì¼ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.
        </div>
      </div>
      <div>
        <label>ë¶ˆëŸ¬ì˜¨ ê³µíœ´ì¼(ì„ íƒí•´ì„œ ì¶”ê°€)</label>
        <div id="holidayList" class="list small muted">ì•„ì§ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="btns" style="margin-top:6px">
      <button id="addSelectedHolidays" class="secondary" type="button">ì„ íƒ ê³µíœ´ì¼ì„ íœ´ê°•ì¼ì— ì¶”ê°€</button>
    </div>

    <div class="divider"></div>

    <h2 style="margin-top:0">ì»¤ë¦¬í˜ëŸ¼</h2>
    <div class="row">
      <div>
        <label for="curriculumSelect">ì»¤ë¦¬í˜ëŸ¼ ì„ íƒ</label>
        <select id="curriculumSelect"></select>
        <div class="note small">ì„ íƒ ì‹œ URLì´ ìë™ìœ¼ë¡œ ë§¤ì¹­ë©ë‹ˆë‹¤.</div>
      </div>
      <div>
        <label for="curriculumUrl">ì»¤ë¦¬í˜ëŸ¼ URL ì½”ë“œ(ìë™)</label>
        <input id="curriculumUrl" type="text" placeholder="ì˜ˆ: ARTBOOKDESIGN" />
        <div class="note small">í•„ìš” ì‹œ ìˆ˜ë™ ìˆ˜ì • ê°€ëŠ¥ (ì»¤ìŠ¤í…€ ì½”ìŠ¤ëŠ” ë¹„í™œì„±í™”).</div>
      </div>
    </div>
    <div id="customCourseBox" style="display:none; margin-top:10px">
      <div class="row">
        <div>
          <label for="customCourseName">ì»¤ìŠ¤í…€ ì½”ìŠ¤ í´ë˜ìŠ¤ëª…(í•„ìˆ˜)</label>
          <input id="customCourseName" type="text" placeholder="ì˜ˆ: 000" />
          <div class="note small">ì¶œë ¥ ë¬¸êµ¬: â€œ1:1 000 í´ë˜ìŠ¤ëŠ” ê°œë³„ ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.â€</div>
        </div>
        <div></div>
      </div>
    </div>

    <div class="btns">
      <button id="generate" type="button">ìµœì¢… ë¬¸êµ¬ ìƒì„±</button>
      <button id="copy" class="secondary" type="button">ë³µì‚¬</button>
      <button id="reset" class="secondary" type="button">ì´ˆê¸°í™”</button>
    </div>

    <div id="alert" class="note"></div>

    <div class="divider"></div>

    <h2 style="margin-top:0">í˜„ì¬ ë“±ë¡ëœ íœ´ê°•ì¼</h2>
    <div id="closedPreview" class="note mono">ë“±ë¡ëœ íœ´ê°•ì¼: ì—†ìŒ</div>
  </section>

  <section class="card">
    <h2>ìµœì¢… ì•ˆë‚´ ë¬¸êµ¬</h2>
    <textarea id="output" class="mono" placeholder="ì™¼ìª½ì—ì„œ ì…ë ¥ í›„ [ìµœì¢… ë¬¸êµ¬ ìƒì„±]ì„ ëˆ„ë¥´ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
    <div class="note">
      DST(ì¸ë¨¸íƒ€ì„) ë³€ê³¡ì ì´ ìˆ˜ì—… ê¸°ê°„ ì¤‘ ì¡´ì¬í•˜ë©´, â€œì²« ë³€ê³¡ ìˆ˜ì—…ì¼â€ë¶€í„° ë³€ê²½ ë‚´ìš©ì„ ìë™ ì•ˆë‚´í•©ë‹ˆë‹¤.
    </div>
  </section>
</main>

<script>
  /*********************
   * ì»¤ë¦¬í˜ëŸ¼ ì˜µì…˜ (í•œêµ­ì–´ í‘œê¸° + URL ìë™ ë§¤ì¹­)
   *********************/
  const CURRICULUM_MAP = {
    "ì•„íŠ¸ë¶ ë””ìì¸ Lv.1":"Elementary",
    "ì•„íŠ¸ë¶ ë””ìì¸ Lv.2":"Pre-intermediate",
    "ì•„íŠ¸ë¶ ë””ìì¸ Lv.3":"Intermediate",
    "ì•„íŠ¸ë¶ ë””ìì¸ Lv.4":"Upper-intermediate",
    "ì•„íŠ¸ë¶ ë””ìì¸ Lv.5":"Advanced",
    "íŒŒìš´ë°ì´ì…˜":"Foundation",
    "ë””í”Œë¡œë§ˆ":"Diploma",
    "ì—ë””í„°":"Editor",
    "ë“œë¡œì‰ ë² ì´ì§":"DrawingBasic",
    "ë“œë¡œì‰ í”„ë¡œ":"DrawingPro",
    "ë“œë¡œì‰ ë¶":"DrawingBook",
    "í’ê²½í™” ë“œë¡œì‰":"Landscape",
    "ì• ë‹ˆë©”ì´ì…˜ ë² ì´ì§":"AnimationBasic",
    "ì• ë‹ˆë©”ì´ì…˜ í”„ë¡œ":"AnimationPro",
    "êµ¿ì¦ˆ ë””ìì¸":"GoodsDesign",
    "ì´ëª¨í‹°ì½˜ ë””ìì¸":"EmoticonDesign",
    "ì–´í”¼ë‹ˆí‹° ë§ˆìŠ¤í„°":"AffinityMaster",
    "ë¹„ë””ì˜¤ ë² ì´ì§":"VideoBasic",
    "ë¹„ë””ì˜¤ í”„ë¡œ":"VideoPro",
    "ëª¨ì…˜ ê·¸ë˜í”½":"Motiongraphics",
    "ë¶ ì• ë‹ˆë©”ì´ì…˜":"BookAnimation",
    "ëª¨ì…˜í´ë¦¬ì˜¤":"Motionfolio",
    "ìŠ¤í¬ë˜ì¹˜ ë² ì´ì§":"ScratchBasic",
    "ìŠ¤í¬ë˜ì¹˜ í”„ë¡œ":"ScratchPro",
    "í”Œë ˆì´ ë¶":"PlayBook",
    "HTML ë¹„ê¸°ë„ˆ":"HTMLBeginner",
    "HTML ë² ì´ì§":"HTMLBasic",
    "HTML í”„ë¡œ":"HTMLPro",
    "ìë°”ìŠ¤í¬ë¦½íŠ¸ ë² ì´ì§":"JavaScriptBasic",
    "ìë°”ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œ":"JavaScriptPro",
    "ìŠ¤í† ë¦¬ í¬ë˜í”„íŒ…":"StoryCrafting",
    "ì•„íŠ¸ ì—ì„¸ì´":"ArtEssay",
    "ì•„ì´ë´í‹°í‹° ë¶":"IdentityBook",
    "í¼ë¸”ë¦¬ì‹±":"Publishing",
    "ì›¹ í”„ë¡œ ë§ˆìŠ¤í„°":"ProMaster",
    "ì›¹ í”„ë¡œí•„":"Profile",
"ë§ˆì¼€íŒ… ë§¤ë‹ˆì§€ë¨¼íŠ¸":"Management",
    "1:1 ë¸Œëœë”© ì½”ìŠ¤":"Branding1on1",
  };

  const CURRICULUM_GROUPS = [
    { group:"ê·¸ë¦¼ì±…/ì–´í”¼ë‹ˆí‹° ë””ìì¸", items:["ì•„íŠ¸ë¶ ë””ìì¸ Lv.1","ì•„íŠ¸ë¶ ë””ìì¸ Lv.2","ì•„íŠ¸ë¶ ë””ìì¸ Lv.3","ì•„íŠ¸ë¶ ë””ìì¸ Lv.4","ì•„íŠ¸ë¶ ë””ìì¸ Lv.5","íŒŒìš´ë°ì´ì…˜","ë””í”Œë¡œë§ˆ","ì—ë””í„°"] },
    { group:"ë””ì§€í„¸ ë“œë¡œì‰", items:["ë“œë¡œì‰ ë² ì´ì§","ë“œë¡œì‰ í”„ë¡œ","ë“œë¡œì‰ ë¶","í’ê²½í™” ë“œë¡œì‰","ì• ë‹ˆë©”ì´ì…˜ ë² ì´ì§","ì• ë‹ˆë©”ì´ì…˜ í”„ë¡œ"] },
    { group:"ìºë¦­í„°/IP", items:["êµ¿ì¦ˆ ë””ìì¸","ì´ëª¨í‹°ì½˜ ë””ìì¸"] },
    { group:"ì˜ìƒ/ëª¨ì…˜", items:["ë¹„ë””ì˜¤ ë² ì´ì§","ë¹„ë””ì˜¤ í”„ë¡œ","ëª¨ì…˜ ê·¸ë˜í”½","ë¶ ì• ë‹ˆë©”ì´ì…˜","ëª¨ì…˜í´ë¦¬ì˜¤"] },
    { group:"ì½”ë“œ ë””ìì¸", items:["ìŠ¤í¬ë˜ì¹˜ ë² ì´ì§","ìŠ¤í¬ë˜ì¹˜ í”„ë¡œ","í”Œë ˆì´ ë¶","HTML ë¹„ê¸°ë„ˆ","HTML ë² ì´ì§","HTML í”„ë¡œ","ìë°”ìŠ¤í¬ë¦½íŠ¸ ë² ì´ì§","ìë°”ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œ"] },
    { group:"ë©”ì‹œì§€ ë””ìì¸", items:["ìŠ¤í† ë¦¬ í¬ë˜í”„íŒ…","ì•„íŠ¸ ì—ì„¸ì´","ì•„ì´ë´í‹°í‹° ë¶","í¼ë¸”ë¦¬ì‹±"] },
    { group:"ì›¹ í”„ë¡œë“€ì„œ", items:["ì›¹ í”„ë¡œ ë§ˆìŠ¤í„°","ì›¹ í”„ë¡œí•„","ë§ˆì¼€íŒ… ë§¤ë‹ˆì§€ë¨¼íŠ¸","1:1 ë¸Œëœë”© ì½”ìŠ¤"] },
    { group:"ê¸°íƒ€", items:["ì–´í”¼ë‹ˆí‹° ë§ˆìŠ¤í„°"] },
  ];

  const CUSTOM_COURSE_LABEL = "ì»¤ìŠ¤í…€ ì½”ìŠ¤(ê°œë³„ ë§ì¶¤)";
  const BRANDING_COURSE_LABEL = "1:1 ë¸Œëœë”© ì½”ìŠ¤";

  /*********************
   * ìº¡ì»· ë¸”ë¡
   *********************/
  const CAPCUT_BLOCK =
`ğŸ“Œ ê°•ì˜ ì‚¬ì „ ì¤€ë¹„ ì•ˆë‚´
(âš ï¸ ìº¡ì»· í”„ë¡œ ê²°ì œ í•„ìˆ˜ ì›” 19,800ì›)

ğŸ¥ ì˜ìƒÂ·ì‚¬ì§„ ì´¬ì˜ ê°€ì´ë“œ

ğŸ” ì´¬ì˜ ì „ ì¤€ë¹„

ì´¬ì˜ ì „, ì¹´ë©”ë¼ ë Œì¦ˆë¥¼ ì²œìœ¼ë¡œ ê¼­ í•œ ë²ˆ ë‹¦ì•„ì£¼ì„¸ìš”.
ì§€ë¬¸ì´ ë¬»ìœ¼ë©´ ì˜ìƒì´ ë¿Œì˜‡ê²Œ ë‚˜ì˜¤ê±°ë‚˜ ë¹›ë²ˆì§ í˜„ìƒì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ¥ ì˜ìƒÂ·ì‚¬ì§„ ì´¬ì˜ ê°€ì´ë“œ

1. ì´¬ì˜ ë¹„ìœ¨
- ë¦´ìŠ¤/ì‡¼ì¸ : ì„¸ë¡œ ì´¬ì˜
- ìœ íŠœë¸Œ: ê°€ë¡œ ì´¬ì˜
ì‚¬ì§„Â·ì˜ìƒì´ ë§ì„ìˆ˜ë¡ í¸ì§‘ ì™„ì„±ë„ê°€ ë†’ìŠµë‹ˆë‹¤

2. ì˜ìƒ ì´¬ì˜ íŒ
- ì¹´ë©”ë¼ëŠ” ì²œì²œíˆ ì›€ì§ì¼ ê²ƒ
- ê°‘ì‘ìŠ¤ëŸ¬ìš´ íœ™ ì›€ì§ì„ì€ í”¼í•  ê²ƒ
- ë©ˆì¶°ì„œ ì´¬ì˜í•˜ê±°ë‚˜, ì²œì²œíˆ ì´ë™í•˜ë©° ì´¬ì˜

3. ì‚¬ì§„ ì´¬ì˜ íŒ
- ì¸ë¬¼ì´ ê¹”ë”í•˜ê²Œ ë‚˜ì˜¨ ì „ì²´ ìƒ· ìœ„ì£¼ë¡œ ì¤€ë¹„

â”â”â”â”â”â”â”â”â”â”â”â”â”â”

`;

  /*********************
   * êµ­ê°€ ê¸°ë³¸ DB (ì¶”ì²œ ì‹œê°„ëŒ€)
   * - êµ­ê°€ë³„ DSTëŠ” í•˜ë“œì½”ë”©í•˜ì§€ ì•ŠìŒ: Intl offset ë³€í™”ë¡œ ìë™ ê°ì§€
   *********************/
  const COUNTRY_DB = [
    { ko:"ë¯¸êµ­", flag:"ğŸ‡ºğŸ‡¸", tz:["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","Pacific/Honolulu"] },
    { ko:"ìºë‚˜ë‹¤", flag:"ğŸ‡¨ğŸ‡¦", tz:["America/Toronto","America/Vancouver","America/Edmonton","America/Winnipeg","America/Halifax","America/St_Johns"] },
    { ko:"ë©•ì‹œì½”", flag:"ğŸ‡²ğŸ‡½", tz:["America/Mexico_City","America/Tijuana","America/Cancun"] },
    { ko:"ë¸Œë¼ì§ˆ", flag:"ğŸ‡§ğŸ‡·", tz:["America/Sao_Paulo","America/Manaus","America/Recife"] },
    { ko:"í˜¸ì£¼", flag:"ğŸ‡¦ğŸ‡º", tz:["Australia/Sydney","Australia/Melbourne","Australia/Brisbane","Australia/Adelaide","Australia/Perth","Australia/Hobart"] },
    { ko:"ì¸ë„ë„¤ì‹œì•„", flag:"ğŸ‡®ğŸ‡©", tz:["Asia/Jakarta","Asia/Makassar","Asia/Jayapura"] },
    { ko:"ëŸ¬ì‹œì•„", flag:"ğŸ‡·ğŸ‡º", tz:["Europe/Moscow","Asia/Yekaterinburg","Asia/Novosibirsk","Asia/Vladivostok","Asia/Kamchatka"] },
    { ko:"ë‰´ì§ˆëœë“œ", flag:"ğŸ‡³ğŸ‡¿", tz:["Pacific/Auckland"] },
    { ko:"ì˜êµ­", flag:"ğŸ‡¬ğŸ‡§", tz:["Europe/London"] },
    { ko:"í”„ë‘ìŠ¤", flag:"ğŸ‡«ğŸ‡·", tz:["Europe/Paris"] },
    { ko:"ë…ì¼", flag:"ğŸ‡©ğŸ‡ª", tz:["Europe/Berlin"] },
    { ko:"ìŠ¤í˜ì¸", flag:"ğŸ‡ªğŸ‡¸", tz:["Europe/Madrid","Atlantic/Canary"] },
    { ko:"í¬ë¥´íˆ¬ê°ˆ", flag:"ğŸ‡µğŸ‡¹", tz:["Europe/Lisbon","Atlantic/Azores"] },
    { ko:"ì¼ë³¸", flag:"ğŸ‡¯ğŸ‡µ", tz:["Asia/Tokyo"] },
    { ko:"ì‹±ê°€í¬ë¥´", flag:"ğŸ‡¸ğŸ‡¬", tz:["Asia/Singapore"] },
    { ko:"í™ì½©", flag:"ğŸ‡­ğŸ‡°", tz:["Asia/Hong_Kong"] },
    { ko:"íƒœêµ­", flag:"ğŸ‡¹ğŸ‡­", tz:["Asia/Bangkok"] },
    { ko:"ë² íŠ¸ë‚¨", flag:"ğŸ‡»ğŸ‡³", tz:["Asia/Ho_Chi_Minh"] },
    { ko:"í•„ë¦¬í•€", flag:"ğŸ‡µğŸ‡­", tz:["Asia/Manila"] },
    { ko:"ì¸ë„", flag:"ğŸ‡®ğŸ‡³", tz:["Asia/Kolkata"] },
    { ko:"ì•„ëì—ë¯¸ë¦¬íŠ¸", flag:"ğŸ‡¦ğŸ‡ª", tz:["Asia/Dubai"] },
  ];

  /*********************
   * ë¯¸êµ­ 50ê°œ ì£¼ + ì‹œê°„ëŒ€ ì˜µì…˜(ì£¼ ë‚´ë¶€ ë¶„í•  í¬í•¨)
   *********************/
  const US_STATES = [
    { name:"Alabama", ko:"ì•Œë¼ë°”ë§ˆ", tzOptions:["America/Chicago"] },
    { name:"Alaska", ko:"ì•Œë˜ìŠ¤ì¹´", tzOptions:["America/Anchorage"] },
    { name:"Arizona", ko:"ì• ë¦¬ì¡°ë‚˜", tzOptions:["America/Phoenix"] },
    { name:"Arkansas", ko:"ì•„ì¹¸ì†Œ", tzOptions:["America/Chicago"] },
    { name:"California", ko:"ìº˜ë¦¬í¬ë‹ˆì•„", tzOptions:["America/Los_Angeles"] },
    { name:"Colorado", ko:"ì½œë¡œë¼ë„", tzOptions:["America/Denver"] },
    { name:"Connecticut", ko:"ì½”ë„¤í‹°ì»·", tzOptions:["America/New_York"] },
    { name:"Delaware", ko:"ë¸ë¼ì›¨ì–´", tzOptions:["America/New_York"] },
    { name:"Florida", ko:"í”Œë¡œë¦¬ë‹¤", tzOptions:["America/New_York","America/Chicago"] },
    { name:"Georgia", ko:"ì¡°ì§€ì•„", tzOptions:["America/New_York"] },
    { name:"Hawaii", ko:"í•˜ì™€ì´", tzOptions:["Pacific/Honolulu"] },
    { name:"Idaho", ko:"ì•„ì´ë‹¤í˜¸", tzOptions:["America/Denver","America/Los_Angeles"] },
    { name:"Illinois", ko:"ì¼ë¦¬ë…¸ì´", tzOptions:["America/Chicago"] },
    { name:"Indiana", ko:"ì¸ë””ì• ë‚˜", tzOptions:["America/New_York","America/Chicago"] },
    { name:"Iowa", ko:"ì•„ì´ì˜¤ì™€", tzOptions:["America/Chicago"] },
    { name:"Kansas", ko:"ìº”ììŠ¤", tzOptions:["America/Chicago","America/Denver"] },
    { name:"Kentucky", ko:"ì¼„í„°í‚¤", tzOptions:["America/New_York","America/Chicago"] },
    { name:"Louisiana", ko:"ë£¨ì´ì§€ì• ë‚˜", tzOptions:["America/Chicago"] },
    { name:"Maine", ko:"ë©”ì¸", tzOptions:["America/New_York"] },
    { name:"Maryland", ko:"ë©”ë¦´ëœë“œ", tzOptions:["America/New_York"] },
    { name:"Massachusetts", ko:"ë§¤ì‚¬ì¶”ì„¸ì¸ ", tzOptions:["America/New_York"] },
    { name:"Michigan", ko:"ë¯¸ì‹œê°„", tzOptions:["America/New_York","America/Chicago"] },
    { name:"Minnesota", ko:"ë¯¸ë„¤ì†Œíƒ€", tzOptions:["America/Chicago"] },
    { name:"Mississippi", ko:"ë¯¸ì‹œì‹œí”¼", tzOptions:["America/Chicago"] },
    { name:"Missouri", ko:"ë¯¸ì£¼ë¦¬", tzOptions:["America/Chicago"] },
    { name:"Montana", ko:"ëª¬íƒœë‚˜", tzOptions:["America/Denver"] },
    { name:"Nebraska", ko:"ë„¤ë¸Œë˜ìŠ¤ì¹´", tzOptions:["America/Chicago","America/Denver"] },
    { name:"Nevada", ko:"ë„¤ë°”ë‹¤", tzOptions:["America/Los_Angeles"] },
    { name:"New Hampshire", ko:"ë‰´í–„í”„ì…”", tzOptions:["America/New_York"] },
    { name:"New Jersey", ko:"ë‰´ì €ì§€", tzOptions:["America/New_York"] },
    { name:"New Mexico", ko:"ë‰´ë©•ì‹œì½”", tzOptions:["America/Denver"] },
    { name:"New York", ko:"ë‰´ìš•", tzOptions:["America/New_York"] },
    { name:"North Carolina", ko:"ë…¸ìŠ¤ìºë¡¤ë¼ì´ë‚˜", tzOptions:["America/New_York"] },
    { name:"North Dakota", ko:"ë…¸ìŠ¤ë‹¤ì½”íƒ€", tzOptions:["America/Chicago","America/Denver"] },
    { name:"Ohio", ko:"ì˜¤í•˜ì´ì˜¤", tzOptions:["America/New_York"] },
    { name:"Oklahoma", ko:"ì˜¤í´ë¼í˜¸ë§ˆ", tzOptions:["America/Chicago"] },
    { name:"Oregon", ko:"ì˜¤ë¦¬ê±´", tzOptions:["America/Los_Angeles","America/Boise"] },
    { name:"Pennsylvania", ko:"íœì‹¤ë² ì´ë‹ˆì•„", tzOptions:["America/New_York"] },
    { name:"Rhode Island", ko:"ë¡œë“œì•„ì¼ëœë“œ", tzOptions:["America/New_York"] },
    { name:"South Carolina", ko:"ì‚¬ìš°ìŠ¤ìºë¡¤ë¼ì´ë‚˜", tzOptions:["America/New_York"] },
    { name:"South Dakota", ko:"ì‚¬ìš°ìŠ¤ë‹¤ì½”íƒ€", tzOptions:["America/Chicago","America/Denver"] },
    { name:"Tennessee", ko:"í…Œë„¤ì‹œ", tzOptions:["America/Chicago","America/New_York"] },
    { name:"Texas", ko:"í…ì‚¬ìŠ¤", tzOptions:["America/Chicago","America/Denver"] },
    { name:"Utah", ko:"ìœ íƒ€", tzOptions:["America/Denver"] },
    { name:"Vermont", ko:"ë²„ëª¬íŠ¸", tzOptions:["America/New_York"] },
    { name:"Virginia", ko:"ë²„ì§€ë‹ˆì•„", tzOptions:["America/New_York"] },
    { name:"Washington", ko:"ì›Œì‹±í„´", tzOptions:["America/Los_Angeles"] },
    { name:"West Virginia", ko:"ì›¨ìŠ¤íŠ¸ë²„ì§€ë‹ˆì•„", tzOptions:["America/New_York"] },
    { name:"Wisconsin", ko:"ìœ„ìŠ¤ì½˜ì‹ ", tzOptions:["America/Chicago"] },
    { name:"Wyoming", ko:"ì™€ì´ì˜¤ë°", tzOptions:["America/Denver"] },
  ];

  const ALL_TZ = (Intl && Intl.supportedValuesOf) ? Intl.supportedValuesOf("timeZone") : [];

  /*********************
   * ìœ í‹¸
   *********************/
  const $ = (id) => document.getElementById(id);
  const WEEKDAY_KO = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
  const WEEKDAY_TO_NUM = { "ì¼":0,"ì›”":1,"í™”":2,"ìˆ˜":3,"ëª©":4,"ê¸ˆ":5,"í† ":6 };

  function showAlert(msg, kind){
    const el = $("alert");
    if(!msg){ el.textContent=""; return; }
    el.textContent = msg;
    el.className = "note " + (kind==="ok" ? "ok" : (kind==="warn" ? "warn" : (kind==="bad" ? "bad" : "muted")));
  }

  function sanitizeText(s){ return (s ?? "").toString().replace(/\r\n/g,"\n"); }

  function parseKorTimeTo24h(amPm, korTimeStr){
    const raw = (korTimeStr || "").trim();
    const m = raw.match(/^(\d{1,2})(?::(\d{1,2}))?$/);
    if(!m) return null;
    let hh = Number(m[1]);
    let mm = m[2] ? Number(m[2]) : 0;
    if(!(hh >= 1 && hh <= 12)) return null;
    if(!(mm >= 0 && mm <= 59)) return null;

    if(amPm === "ì˜¤ì „"){
      if(hh === 12) hh = 0;
    }else{
      if(hh !== 12) hh += 12;
    }
    return { hh, mm };
  }

  // isoDate(YYYY-MM-DD)ì˜ "í•œêµ­ ë¡œì»¬ ì‹œê°„(hh24:mm)"ì„ UTC instant(Date)ë¡œ ë§Œë“ ë‹¤.
  function makeKoreaZonedDate(isoDate, hh24, mm){
    const [y,mo,d] = isoDate.split("-").map(Number);
    const utcMillis = Date.UTC(y, mo-1, d, hh24 - 9, mm, 0, 0);
    return new Date(utcMillis);
  }

  // âœ… ì‹œê°„ í‘œê¸° ê·œì¹™:
  // - ì •ê°: "9ì‹œ"
  // - ë¶„ ìˆìŒ: "9:30"
  function formatInTimeZone(dateObj, timeZone){
    const weekday = new Intl.DateTimeFormat("ko-KR", { timeZone, weekday:"short" }).format(dateObj);

    const parts = new Intl.DateTimeFormat("ko-KR", {
      timeZone,
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    }).formatToParts(dateObj);

    const hh = Number(parts.find(p => p.type === "hour")?.value ?? "0");
    const mm = Number(parts.find(p => p.type === "minute")?.value ?? "0");
    const amPm = (hh < 12) ? "ì˜¤ì „" : "ì˜¤í›„";

    let h12 = hh % 12;
    if(h12 === 0) h12 = 12;

    const time = (mm === 0) ? `${h12}ì‹œ` : `${h12}:${String(mm).padStart(2,"0")}`;
    return { weekday, amPm, time };
  }

  function toDateLocal(iso){ return new Date(iso + "T00:00:00"); }
  function addDays(dateObj, days){ const d = new Date(dateObj); d.setDate(d.getDate()+days); return d; }

  function findFirstClassDateKST(startISO, endISO, targetWeekdayKo){
    const start = toDateLocal(startISO);
    const end = toDateLocal(endISO);
    if(isNaN(start) || isNaN(end)) return null;

    const target = WEEKDAY_TO_NUM[targetWeekdayKo];
    if(target === undefined) return null;

    const startW = start.getDay();
    let delta = target - startW;
    if(delta < 0) delta += 7;

    const first = addDays(start, delta);
    if(first > end) return null;

    const y = first.getFullYear();
    const m = String(first.getMonth()+1).padStart(2,"0");
    const d = String(first.getDate()).padStart(2,"0");
    return `${y}-${m}-${d}`;
  }

  function setSelectOptions(selectEl, options, placeholder){
    selectEl.innerHTML = "";
    if(placeholder){
      const o = document.createElement("option");
      o.value = "";
      o.textContent = placeholder;
      selectEl.appendChild(o);
    }
    options.forEach(v=>{
      const o = document.createElement("option");
      o.value = v;
      o.textContent = v;
      selectEl.appendChild(o);
    });
    selectEl.disabled = options.length === 0;
  }

  function flagFromCountryKo(koName){
    const found = COUNTRY_DB.find(c => c.ko === (koName||"").trim());
    return found?.flag || "";
  }

  function formatMD(iso){
    const d = toDateLocal(iso);
    return `${d.getMonth()+1}/${d.getDate()}`;
  }

  // âœ… â€œâ€¢ ìˆ˜ì—… ì‹œê°„:â€ ì¤„ ì¶œë ¥ìš©
  function formatTimeLine(flag, weekday, amPm, time, suffix=""){
    // suffix ì˜ˆ: " (1ì‹œê°„ ìˆ˜ì—…)" or "" etc.
    return `${flag} ${weekday}ìš”ì¼ ${amPm} ${time}${suffix}`;
  }

  // âœ… íŠ¹ì • Date + timeZoneì˜ UTC offset(ë¶„) êµ¬í•˜ê¸°
  // - DSTê°€ 1ì‹œê°„/2ì‹œê°„ì´ì–´ë„ diffMinutesë¡œ ìë™ ê³„ì‚°ë¨
  function getUtcOffsetMinutes(date, timeZone){
    const fmt = new Intl.DateTimeFormat("en-US", {
      timeZone,
      hour12: false,
      year: "numeric", month: "2-digit", day: "2-digit",
      hour: "2-digit", minute: "2-digit"
    });

    const parts = fmt.formatToParts(date);
    const map = Object.fromEntries(parts.map(p => [p.type, p.value]));

    const asUTC = Date.UTC(
      Number(map.year),
      Number(map.month) - 1,
      Number(map.day),
      Number(map.hour),
      Number(map.minute)
    );

    return (asUTC - date.getTime()) / 60000;
  }

  // âœ… ìˆ˜ì—… ê¸°ê°„ ì¤‘ "ìˆ˜ì—…ì¼(ì£¼ 1íšŒ)" ê¸°ì¤€ìœ¼ë¡œ offset ë³€í™”ê°€ ì²˜ìŒ ìƒê¸°ëŠ” ë‚  ì°¾ê¸°
  // ë°˜í™˜: { iso, diffMinutes, baseOffset, newOffset } or null
  function findDstShiftFirstClass({
    startISO, endISO, weekdayKo, kstTime24, targetTz
  }){
    const start = toDateLocal(startISO);
    const end = toDateLocal(endISO);
    const targetDay = WEEKDAY_TO_NUM[weekdayKo];
    if(targetDay === undefined) return null;

    // ì²« ìˆ˜ì—…ì¼(í•œêµ­ ë‹¬ë ¥ ê¸°ì¤€)
    let cur = new Date(start);
    while(cur.getDay() !== targetDay) cur.setDate(cur.getDate() + 1);
    if(cur > end) return null;

    // ê¸°ì¤€ offset = ì²« ìˆ˜ì—…ì¼ ì¸ìŠ¤í„´íŠ¸ ê¸°ì¤€
    const baseISO = cur.toISOString().slice(0,10);
    const baseInstantKST = makeKoreaZonedDate(baseISO, kstTime24.hh, kstTime24.mm);
    const baseOffset = getUtcOffsetMinutes(baseInstantKST, targetTz);

    // ë‹¤ìŒ ìˆ˜ì—…ì¼(7ì¼ ë‹¨ìœ„)ë¡œ ëŒë©´ì„œ offset ë³€í™” ê°ì§€
    while(cur <= end){
      const iso = cur.toISOString().slice(0,10);
      const inst = makeKoreaZonedDate(iso, kstTime24.hh, kstTime24.mm);
      const off = getUtcOffsetMinutes(inst, targetTz);
      if(off !== baseOffset){
        return {
          iso,
          diffMinutes: off - baseOffset,
          baseOffset,
          newOffset: off,
        };
      }
      cur.setDate(cur.getDate() + 7);
    }
    return null;
  }

  /*********************
   * íœ´ê°•ì¼ ìƒíƒœ
   *********************/
  let closedList = []; // { date:"YYYY-MM-DD", name:"..." }
  let fetchedHolidays = [];

  function renderClosedPreview(){
    const box = $("closedPreview");
    if(closedList.length === 0){
      box.textContent = "ë“±ë¡ëœ íœ´ê°•ì¼: ì—†ìŒ";
      return;
    }
    const sorted = [...closedList].sort((a,b)=>a.date.localeCompare(b.date));
    const lines = sorted.map((x, i) => {
      const d = toDateLocal(x.date);
      const m = d.getMonth()+1, day = d.getDate();
      const w = WEEKDAY_KO[d.getDay()];
      const nm = x.name ? `(${x.name})` : "";
      return `${i+1}) ${m}/${day}(${w})${nm}`;
    });
    box.textContent = "ë“±ë¡ëœ íœ´ê°•ì¼:\n" + lines.join("\n");
  }

  function upsertClosed(dateISO, name){
    const idx = closedList.findIndex(x => x.date === dateISO);
    if(idx >= 0){
      if(!closedList[idx].name && name) closedList[idx].name = name;
      return;
    }
    closedList.push({ date: dateISO, name: name || "" });
    closedList.sort((a,b)=>a.date.localeCompare(b.date));
  }

  /*********************
   * í•œêµ­ ê³µíœ´ì¼ API (Nager.Date)
   *********************/
  async function fetchKoreanHolidaysBetween(startISO, endISO){
    const start = toDateLocal(startISO);
    const end = toDateLocal(endISO);
    if(isNaN(start) || isNaN(end)) throw new Error("ë‚ ì§œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");

    const years = new Set([start.getFullYear(), end.getFullYear()]);
    const all = [];

    for(const y of years){
      const url = `https://date.nager.at/api/v3/PublicHolidays/${y}/KR`;
      const res = await fetch(url);
      if(!res.ok) throw new Error(`ê³µíœ´ì¼ API í˜¸ì¶œ ì‹¤íŒ¨(${y})`);
      const data = await res.json();
      all.push(...data);
    }
    return all.filter(h => h.date >= startISO && h.date <= endISO)
              .sort((a,b)=>a.date.localeCompare(b.date));
  }

  function renderHolidayList(){
    const box = $("holidayList");
    if(fetchedHolidays.length === 0){
      box.textContent = "ë¶ˆëŸ¬ì˜¨ ê³µíœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤.";
      box.className = "list small muted";
      return;
    }
    box.className = "list small";
    box.innerHTML = fetchedHolidays.map((h, i)=>{
      const d = toDateLocal(h.date);
      const m = d.getMonth()+1, day = d.getDate();
      const w = WEEKDAY_KO[d.getDay()];
      const label = `${m}/${day}(${w}) - ${h.localName || h.name || "ê³µíœ´ì¼"}`;
      return `
        <div class="checkboxRow">
          <input type="checkbox" id="h_${i}" data-idx="${i}" checked />
          <label for="h_${i}" style="margin:0; color:inherit; font-size:12px; line-height:1.35">${label}</label>
        </div>
      `;
    }).join("");
  }

  /*********************
   * ì»¤ë¦¬í˜ëŸ¼ / êµ­ê°€ / ë¯¸êµ­ ì£¼ ì´ˆê¸°í™”
   *********************/
  function initCurriculumSelect(){
    const sel = $("curriculumSelect");
    sel.innerHTML = "";

    const optCustom = document.createElement("option");
    optCustom.value = CUSTOM_COURSE_LABEL;
    optCustom.textContent = CUSTOM_COURSE_LABEL;
    sel.appendChild(optCustom);

    CURRICULUM_GROUPS.forEach(g=>{
      const og = document.createElement("optgroup");
      og.label = g.group;
      g.items.forEach(name=>{
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        og.appendChild(opt);
      });
      sel.appendChild(og);
    });
  }

  function initCountryDatalist(){
    const dl = $("countryList");
    dl.innerHTML = "";
    COUNTRY_DB.forEach(c=>{
      const opt = document.createElement("option");
      opt.value = c.ko;
      dl.appendChild(opt);
    });
  }

  function initUsStateSelect(){
    const sel = $("usStateSelect");
    sel.innerHTML = "";
    const opt0 = document.createElement("option");
    opt0.value = "";
    opt0.textContent = "ì£¼ ì„ íƒ";
    sel.appendChild(opt0);

    US_STATES.forEach(s=>{
      const opt = document.createElement("option");
      opt.value = s.name;
      opt.textContent = `${s.ko}ì£¼ (${s.name})`;
      sel.appendChild(opt);
    });
  }

  function applyCountryToTzOptions(countryKo){
    const found = COUNTRY_DB.find(c => c.ko === (countryKo||"").trim());
    if(!found){
      setSelectOptions($("tzSelect"), [], "ì‹œê°„ëŒ€ ì§ì ‘ ê²€ìƒ‰/ì…ë ¥ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”");
      return;
    }
    setSelectOptions($("tzSelect"), found.tz, "ì‹œê°„ëŒ€ ì„ íƒ");
    if(found.tz.length > 0) $("tzSelect").value = found.tz[0];
  }

  function applyUSStateToTzOptions(stateName){
    const s = US_STATES.find(x => x.name === stateName);
    if(!s){
      setSelectOptions($("tzSelect"), ["America/New_York","America/Chicago","America/Denver","America/Los_Angeles"], "ì‹œê°„ëŒ€ ì„ íƒ");
      return;
    }
    setSelectOptions($("tzSelect"), s.tzOptions, s.tzOptions.length > 1 ? "ì‹œê°„ëŒ€(ì£¼ ë‚´ë¶€ ë¶„í• )" : "ì‹œê°„ëŒ€");
    if(s.tzOptions.length > 0) $("tzSelect").value = s.tzOptions[0];
  }

  /*********************
   * í•´ì™¸ í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°(ì²« ìˆ˜ì—…ì¼ ê¸°ì¤€)
   *********************/
  function updateLocalPreview(){
    const loc = $("studentLocation").value;
    if(loc !== "OVERSEAS"){
      $("localPreviewPill").textContent = "í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: -";
      return;
    }

    const startDay = $("startDay").value;
    const endDay = $("endDay").value;
    const weekday = $("weekday").value;
    const amPm = $("amPm").value;
    const korTimeStr = $("korTime").value.trim();
    const tz = $("tzSelect").value;

    if(!startDay || !endDay || !korTimeStr || !tz){
      $("localPreviewPill").textContent = "í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: -";
      return;
    }

    const parsed = parseKorTimeTo24h(amPm, korTimeStr);
    if(!parsed){
      $("localPreviewPill").textContent = "í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: í•œêµ­ì‹œê°„ í˜•ì‹ ì˜¤ë¥˜";
      return;
    }

    const firstClassISO = findFirstClassDateKST(startDay, endDay, weekday);
    if(!firstClassISO){
      $("localPreviewPill").textContent = "í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: ê¸°ê°„ ë‚´ í•´ë‹¹ ìš”ì¼ ìˆ˜ì—… ì—†ìŒ";
      return;
    }

    try{
      const kstInstant = makeKoreaZonedDate(firstClassISO, parsed.hh, parsed.mm);
      const local = formatInTimeZone(kstInstant, tz);
      $("localPreviewPill").textContent = `í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: ${local.weekday}ìš”ì¼ ${local.amPm} ${local.time}`;
    }catch(e){
      $("localPreviewPill").textContent = "í˜„ì§€ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°: ê³„ì‚° ì‹¤íŒ¨(ì‹œê°„ëŒ€ í™•ì¸)";
    }
  }

  /*********************
   * ìµœì¢… ë©”ì‹œì§€ ìƒì„±
   *********************/
  function buildMessage(){
    const studentName = $("studentName").value.trim();
    const enrollType = $("enrollType").value;
    const familyType = $("familyType").value;
    const classType = $("classType").value;

    const startDay = $("startDay").value;
    const endDay = $("endDay").value;
    const weekday = $("weekday").value;
    const amPm = $("amPm").value;
    const korTimeStr = $("korTime").value.trim();

    const curriculumName = $("curriculumSelect").value;
    const curriculumUrl = $("curriculumUrl").value.trim();

    const studentLocation = $("studentLocation").value;
    const dstMode = $("dstMode").value;

    if(!studentName) return { ok:false, error:"ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." };
    if(!startDay) return { ok:false, error:"ì‹œì‘ì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”." };
    if(!endDay) return { ok:false, error:"ì¢…ë£Œì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”." };
    if(!korTimeStr) return { ok:false, error:"í•œêµ­ì‹œê°„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ì˜ˆ: 7 ë˜ëŠ” 7:30)" };

    const isCustomCourse = (curriculumName === CUSTOM_COURSE_LABEL);
    const isBrandingCourse = (curriculumName === BRANDING_COURSE_LABEL);
    if(!isCustomCourse && !isBrandingCourse && !curriculumUrl) return { ok:false, error:"ì»¤ë¦¬í˜ëŸ¼ URL ì½”ë“œê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. (ì„ íƒí•˜ë©´ ìë™ ì…ë ¥ë©ë‹ˆë‹¤)" };

    const parsed = parseKorTimeTo24h(amPm, korTimeStr);
    if(!parsed) return { ok:false, error:"í•œêµ­ì‹œê°„ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì˜ˆ: 7 ë˜ëŠ” 7:30, ì‹œê°„ì€ 1~12)" };

    if(isCustomCourse){
      const cc = $("customCourseName").value.trim();
      if(!cc) return { ok:false, error:"ì»¤ìŠ¤í…€ ì½”ìŠ¤ í´ë˜ìŠ¤ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ì˜ˆ: 000)" };
    }

    const namePrefix = (familyType === "SIBLINGS") ? `${studentName}ì˜ ` : "";

    const greeting = (enrollType === "NEW")
      ? "ğŸ’¬ ë¬¸ì˜ëŠ” ì–¸ì œë“  ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë©”ì‹œì§€ ì£¼ì„¸ìš”!"
      : "ì´ë²ˆ í´ë˜ìŠ¤ë„ í•¨ê»˜ ì¦ê²ê²Œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤!";

    let duration = (classType === "ONE_ON_ONE") ? "40ë¶„" : "1ì‹œê°„";

    // âœ… ì˜ˆì™¸: 1:1 ë¸Œëœë”© ì½”ìŠ¤ëŠ” 1ì‹œê°„ ê³ ì •
    if (curriculumName === BRANDING_COURSE_LABEL) duration = "1ì‹œê°„";

    // í•œêµ­ì‹œê°„ í‘œê¸° ê·œì¹™ ë°˜ì˜
    const korH12 = (parsed.hh % 12 || 12);
    const korTimeDisplay = (parsed.mm === 0)
      ? `${korH12}ì‹œ`
      : `${korH12}:${String(parsed.mm).padStart(2,"0")}`;

    const isArtBook = curriculumName.includes("ì•„íŠ¸ë¶");
    const isVideo = (curriculumName === "ë¹„ë””ì˜¤ ë² ì´ì§" || curriculumName === "ë¹„ë””ì˜¤ í”„ë¡œ");
    const stepPrefix = isArtBook ? "ë‹¨ê³„ë³„ " : "";

    const absence = (classType === "GROUP")
      ? `ğŸ“ ê²°ì„ & ë³´ê°• ì •ì±…
â€¢ ì‚¬ì „ ì—°ë½ ì‹œ â†’ ${stepPrefix}1íšŒ ë¬´ë£Œ ë³´ê°• ê°€ëŠ¥
â€¢ ë‹¹ì¼ ì·¨ì†Œ/ë³´ê°• ìš”ì²­ ì‹œ â†’ 1:1 ìˆ˜ì—… 3ë§Œ ì›

â”â”â”â”â”â”â”â”â”â”â”â”â”â”

`
      : "";

    const capcutBlock = isVideo ? CAPCUT_BLOCK : "";

    // ì‹œì‘/ì¢…ë£Œ ìš”ì¼
    const startW = WEEKDAY_KO[toDateLocal(startDay).getDay()];
    const endW = WEEKDAY_KO[toDateLocal(endDay).getDay()];

    // âœ… íœ´ê°•ì¼: ë‚ ì§œìˆœ + ì½¤ë§ˆ ì—°ê²° + 1/1(ì›”, ìƒˆí•´)
    const sortedClosed = [...closedList].sort((a,b)=>a.date.localeCompare(b.date));
    let closedBlock = "";
    if (sortedClosed.length > 0) {
      const items = sortedClosed.map(x => {
        const d = toDateLocal(x.date);
        const m = d.getMonth() + 1;
        const day = d.getDate();
        const w = WEEKDAY_KO[d.getDay()];
        const label = x.name ? `(${w}, ${x.name})` : `(${w})`;
        return `${m}/${day}${label}`;
      });
      closedBlock = `â€¢ íœ´ê°•ì¼: ${items.join(", ")}\n`;
    }

    // âœ… ìˆ˜ì—… ì‹œê°„ ë¼ì¸ ìƒì„± (ìš”ì²­ í¬ë§·)
    let timeLine = "";

    // [ì‹œì°¨ ì—†ëŠ” ê²½ìš°] = êµ­ë‚´(í•œêµ­)
    if(studentLocation === "DOMESTIC"){
      // ìš”ì²­: â€œâ€¢ ìˆ˜ì—… ì‹œê°„: í† ìš”ì¼ ì˜¤ì „ 9ì‹œ (1ì‹œê°„ ìˆ˜ì—…)â€
      // -> ìš”ì¼ì€ ì„ íƒí•œ ìš”ì¼ ê¸°ì¤€ìœ¼ë¡œ ì¶œë ¥
      timeLine = `â€¢ ìˆ˜ì—… ì‹œê°„: ${weekday}ìš”ì¼ ${amPm} ${korTimeDisplay} (${duration} ìˆ˜ì—…)\n`;
    } else {
      const countryKo = $("countryInput").value.trim();
      const tz = $("tzSelect").value || "";
      const customFlag = $("customFlag").value.trim();
      const flag = customFlag || flagFromCountryKo(countryKo) || "ğŸ³ï¸";

      const firstClassISO = findFirstClassDateKST(startDay, endDay, weekday);
      if(!firstClassISO){
        return { ok:false, error:"ì‹œì‘~ì¢…ë£Œ ê¸°ê°„ ì•ˆì— ì„ íƒí•œ ìš”ì¼ì˜ ì²« ìˆ˜ì—…ì¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‚ ì§œ/ìš”ì¼ì„ í™•ì¸í•´ ì£¼ì„¸ìš”." };
      }
      if(!tz){
        return { ok:false, error:"í•´ì™¸ ìˆ˜ê°•ìƒì€ ì‹œê°„ëŒ€ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. (ì‹œê°„ëŒ€ ì„ íƒ/ê²€ìƒ‰)" };
      }

      const firstInstantKST = makeKoreaZonedDate(firstClassISO, parsed.hh, parsed.mm);
      const localFirst = formatInTimeZone(firstInstantKST, tz);

      // ê¸°ê°„ ì¤‘ DST ë³€ê³¡ ìˆ˜ì—…ì¼(ì²« ë°œìƒ) ì°¾ê¸°
      const dstShift = findDstShiftFirstClass({
        startISO: startDay,
        endISO: endDay,
        weekdayKo: weekday,
        kstTime24: parsed,
        targetTz: tz
      });

      const hasDstShift = !!dstShift;
      const shouldExplainShift = hasDstShift && (dstMode === "STUDENT_CHANGE" || dstMode === "TEACHER_CHANGE");

      // ê¸°ë³¸ ë¸”ë¡ (ì¸ë¨¸íƒ€ì„ ì—†ê±°ë‚˜ / AUTO ëª¨ë“œ)
      // ìš”ì²­ í¬ë§·:
      // â€¢ ìˆ˜ì—… ì‹œê°„:
      // ğŸ‡¨ğŸ‡¦ ê¸ˆìš”ì¼ ì˜¤í›„ 4ì‹œ
      // ğŸ‡°ğŸ‡· í† ìš”ì¼ ì˜¤ì „ 9ì‹œ (1ì‹œê°„ ìˆ˜ì—…)
      // â€» â€œì‹œì°¨ ì—†ëŠ” ê²½ìš°â€ëŠ” êµ­ë‚´ì—ì„œ ì²˜ë¦¬
      if(dstMode === "TEACHER_CHANGE" && shouldExplainShift){
        // ì˜ˆì‹œ ìš”êµ¬: (ê°•ì‚¬ë§Œ ë°”ë€ŒëŠ” ê²½ìš°) â†’ durationì€ í˜„ì§€ ì¤„ì—, í•œêµ­ ì¤„ì—ëŠ” ë³€ê²½ í›„ ì‹œê°„ë§Œ í‘œì‹œ
        timeLine =
`â€¢ ìˆ˜ì—… ì‹œê°„:
${formatTimeLine(flag, localFirst.weekday, localFirst.amPm, localFirst.time, ` (${duration} ìˆ˜ì—…)`)}
${formatTimeLine("ğŸ‡°ğŸ‡·", weekday, amPm, korTimeDisplay, "")}
`;
      } else {
        // ì¼ë°˜(ì—†ìŒ/í•™ìƒë³€ê²½/ìë™): durationì€ í•œêµ­ ì¤„ ëì—
        timeLine =
`â€¢ ìˆ˜ì—… ì‹œê°„:
${formatTimeLine(flag, localFirst.weekday, localFirst.amPm, localFirst.time, "")}
${formatTimeLine("ğŸ‡°ğŸ‡·", weekday, amPm, korTimeDisplay, ` (${duration} ìˆ˜ì—…)`)}
`;
      }

      // DST ë³€ê³¡ì  ì•ˆë‚´ ë¬¸êµ¬
      if(shouldExplainShift){
        const shiftISO = dstShift.iso;
        const shiftDate = toDateLocal(shiftISO);
        const m = shiftDate.getMonth() + 1;
        const d = shiftDate.getDate();

        const shiftInstantKST_sameClock = makeKoreaZonedDate(shiftISO, parsed.hh, parsed.mm);
        const localAfter = formatInTimeZone(shiftInstantKST_sameClock, tz);

        // â€œ3/13(ê¸ˆ)â€ì˜ ìš”ì¼ í‘œê¸°ëŠ” í˜„ì§€ ìš”ì¼ë¡œ ë§ì¶”ëŠ” ê²Œ ìì—°ìŠ¤ëŸ¬ì›€
        const localWeekdayOnShift = localAfter.weekday;

        // diffMinutes: newOffset - baseOffset
        // ì˜ˆ: ë‰´ìš• DST ì‹œì‘ â†’ offset -300 -> -240 => diff +60 (í˜„ì§€ ì‹œê°„ì´ +1ì‹œê°„ ëŠ¦ê²Œ í‘œì‹œë¨)
        const diffMin = dstShift.diffMinutes;

        if(dstMode === "STUDENT_CHANGE"){
          // ìš”ì²­ í¬ë§·:
          // *ì¸ë¨¸íƒ€ì„ ì‹œì‘ í›„ â¬‡ï¸
          // 3/13(ê¸ˆ)ë¶€í„° ğŸ‡¨ğŸ‡¦ ì˜¤í›„ 5ì‹œë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
          // (ğŸ‡°ğŸ‡· í†  ì˜¤ì „ 9ì‹œ)
          timeLine +=
`\n*ì¸ë¨¸íƒ€ì„ ì‹œì‘ í›„ â¬‡ï¸
${m}/${d}(${localWeekdayOnShift})ë¶€í„° ${flag} ${localAfter.amPm} ${localAfter.time}ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
(ğŸ‡°ğŸ‡· ${weekday} ${amPm} ${korTimeDisplay})
`;
        }

        if(dstMode === "TEACHER_CHANGE"){
          // â€œê°•ì‚¬ë§Œ ë°”ë€œâ€ = í˜„ì§€ ì‹œê°„ì„ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ë ¤ë©´
          // DST ì‹œì‘ í›„ í•œêµ­ ì‹œê°„ì€ (í˜„ì§€ ë³€í™”ëŸ‰)ë§Œí¼ ë°˜ëŒ€ë¡œ ì´ë™
          // newKSTInstant = shiftInstantKST_sameClock - diffMin
          const newKstInstant = new Date(shiftInstantKST_sameClock.getTime() - diffMin * 60000);
          const koreaAfter = formatInTimeZone(newKstInstant, "Asia/Seoul");

          // ìš”ì²­ ì˜ˆì‹œ í˜•íƒœ(í•œ ì¤„):
          // ğŸ‡°ğŸ‡· ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ (ì¸ë¨¸íƒ€ì„ ì‹œì‘ í›„ > í•œêµ­ ì˜¤ì „ 8ì‹œ)
          // -> â€œì¸ë¨¸íƒ€ì„ ì‹œì‘ í›„ > í•œêµ­ {koreaAfter.amPm} {koreaAfter.time}â€
          // -> koreaAfter.weekdayëŠ” ë³€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•¨ê»˜ í‘œê¸°(ì•ˆì „). ì‚¬ìš©ìê°€ ì›í•˜ë©´ ìš”ì¼ ì œê±°ë„ ê°€ëŠ¥.
          // ì—¬ê¸°ì„œëŠ” ê¸°ì¡´ â€œğŸ‡°ğŸ‡· {weekday}ìš”ì¼ ...â€ì„ ìœ ì§€í•˜ê³ , ë³€ê³¡ í›„ ì‹œê°„ë§Œ ì•ˆë‚´.
          timeLine = timeLine.trimEnd() + ` (ì¸ë¨¸íƒ€ì„ ì‹œì‘ í›„ > í•œêµ­ ${koreaAfter.amPm} ${koreaAfter.time})\n`;
        }
      }
    }

    const msg =
`ì•ˆë…•í•˜ì„¸ìš”! ğŸ˜Š
${namePrefix}ì–´í”¼ë‹ˆí‹° ìœ ë‹ˆë²„ìŠ¤ í´ë˜ìŠ¤ ì¼ì • ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ—“ï¸ í´ë˜ìŠ¤ ì¼ì • ì•ˆë‚´
â€¢ ìˆ˜ì—… ê¸°ê°„: ${formatMD(startDay)}(${startW}) ~ ${formatMD(endDay)}(${endW})
${closedBlock}â€¢ ìˆ˜ì—… ìš”ì¼: ë§¤ì£¼ ${weekday}ìš”ì¼
${timeLine}
${(curriculumName === CUSTOM_COURSE_LABEL)
        ? `1:1 ${$("customCourseName").value.trim()} í´ë˜ìŠ¤ëŠ”
ê°œë³„ ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.`
        : (curriculumName === BRANDING_COURSE_LABEL)
          ? `1:1 ë¸Œëœë”© ì½”ìŠ¤ëŠ”
ê°œë³„ ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.`
          : `${curriculumName} ì»¤ë¦¬í˜ëŸ¼ ë³´ê¸°
ğŸ‘‰ğŸ» https://affinityuniverse.com/${curriculumUrl}` }

â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Œ ìˆ˜ì—… ì°¸ì—¬ ì•ˆë‚´
â€¢ ìˆ˜ì—… ì‹œì‘ 5ë¶„ ì „ ì ‘ì† ë¶€íƒë“œë ¤ìš”!
â€¢ ë‹¹ì¼ ì˜¤ì „ì— ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”

${absence}${capcutBlock}${greeting}
ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ¥°`;

    return { ok:true, text: msg };
  }

  /*********************
   * ë³µì‚¬
   *********************/
  async function copyToClipboard(text){
    const t = sanitizeText(text);
    if(!t.trim()) return { ok:false, reason:"empty" };

    if(navigator.clipboard && window.isSecureContext){
      try{
        await navigator.clipboard.writeText(t);
        return { ok:true };
      }catch(e){}
    }
    try{
      const ta = $("output");
      ta.focus();
      ta.select();
      const ok = document.execCommand("copy");
      return { ok };
    }catch(e){
      return { ok:false, reason:"blocked" };
    }
  }

  /*********************
   * ì´ë²¤íŠ¸ ë°”ì¸ë”©
   *********************/
  function bind(){
    const rePreview = () => { updateLocalPreview(); };

    ["startDay","endDay","weekday","amPm","korTime","tzSelect","studentLocation"].forEach(id=>{
      $(id).addEventListener("input", rePreview);
      $(id).addEventListener("change", rePreview);
    });

    $("studentLocation").addEventListener("change", ()=>{
      const v = $("studentLocation").value;
      $("overseasBox").style.display = (v === "OVERSEAS") ? "block" : "none";
      $("tzBadge").textContent = (v === "OVERSEAS")
        ? "í•´ì™¸: ìˆ˜ì—… ê¸°ê°„ ë‚´ DST ë³€ê³¡ì  ìë™ ê°ì§€"
        : "í•´ì™¸ ì„¤ì • ì‹œ í˜„ì§€ì‹œê°„(ìš”ì¼ í¬í•¨) ìë™ í‘œì‹œ";
      updateLocalPreview();
    });

    $("countryInput").addEventListener("input", ()=>{
      const ko = $("countryInput").value.trim();
      const isUS = (ko === "ë¯¸êµ­");

      $("usStateBox").style.display = isUS ? "block" : "none";
      if(isUS){
        applyCountryToTzOptions("ë¯¸êµ­");
      }else{
        applyCountryToTzOptions(ko);
      }
      updateLocalPreview();
    });

    $("usStateSelect").addEventListener("change", ()=>{
      const stateName = $("usStateSelect").value;
      if(stateName){
        applyUSStateToTzOptions(stateName);
      }else{
        applyCountryToTzOptions("ë¯¸êµ­");
      }
      updateLocalPreview();
    });

    $("tzSearch").addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        e.preventDefault();
        $("applyTzSearch").click();
      }
    });

    $("applyTzSearch").addEventListener("click", ()=>{
      const q = $("tzSearch").value.trim();
      if(!q){
        showAlert("ì‹œê°„ëŒ€ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "warn");
        return;
      }
      let tz = "";
      if(ALL_TZ.length > 0){
        tz = ALL_TZ.find(x => x === q) || ALL_TZ.find(x => x.toLowerCase().includes(q.toLowerCase())) || "";
      }else{
        tz = q;
      }
      if(!tz){
        showAlert("í•´ë‹¹ ì‹œê°„ëŒ€ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì˜ˆ: America/Chicago)", "warn");
        return;
      }
      const sel = $("tzSelect");
      const exists = Array.from(sel.options).some(o => o.value === tz);
      if(!exists){
        const opt = document.createElement("option");
        opt.value = tz;
        opt.textContent = tz;
        sel.appendChild(opt);
      }
      sel.value = tz;
      showAlert("ì‹œê°„ëŒ€ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
      updateLocalPreview();
    });

    // íœ´ì¼ í”„ë¦¬ì…‹ â†’ ìë™ ì…ë ¥
    $("closedNamePreset").addEventListener("change", ()=>{
      const v = $("closedNamePreset").value;
      $("closedName").value = v || "";
    });

    $("addClosed").addEventListener("click", ()=>{
      const d = $("closedDate").value;
      const n = (($("closedNamePreset")?.value || "").trim()) || $("closedName").value.trim();
      if(!d){
        showAlert("íœ´ê°•ì¼ ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.", "warn");
        return;
      }
      upsertClosed(d, n);
      $("closedDate").value = "";
      $("closedNamePreset").value = "";
      $("closedName").value = "";
      renderClosedPreview();
      showAlert("íœ´ê°•ì¼ì´ ì¶”ê°€/ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    });

    $("clearClosed").addEventListener("click", ()=>{
      closedList = [];
      renderClosedPreview();
      showAlert("íœ´ê°•ì¼ì´ ì „ì²´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    });

    $("fetchHolidays").addEventListener("click", async ()=>{
      const start = $("startDay").value;
      const end = $("endDay").value;
      if(!start || !end){
        showAlert("ê³µíœ´ì¼ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ì‹œì‘ì¼/ì¢…ë£Œì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.", "warn");
        return;
      }
      $("holidayList").textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      try{
        fetchedHolidays = await fetchKoreanHolidaysBetween(start, end);
        renderHolidayList();
        showAlert(`ê³µíœ´ì¼ ${fetchedHolidays.length}ê°œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, "ok");
      }catch(e){
        $("holidayList").textContent = "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
        showAlert(`ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${e.message}`, "bad");
      }
    });

    $("addSelectedHolidays").addEventListener("click", ()=>{
      if(fetchedHolidays.length === 0){
        showAlert("ë¨¼ì € ê³µíœ´ì¼ì„ ë¶ˆëŸ¬ì™€ ì£¼ì„¸ìš”.", "warn");
        return;
      }
      const checks = Array.from($("holidayList").querySelectorAll("input[type=checkbox][data-idx]"));
      let added = 0;
      checks.forEach(ch=>{
        if(!ch.checked) return;
        const idx = Number(ch.dataset.idx);
        const h = fetchedHolidays[idx];
        if(!h) return;
        upsertClosed(h.date, h.localName || h.name || "ê³µíœ´ì¼");
        added++;
      });
      renderClosedPreview();
      showAlert(`ì„ íƒ ê³µíœ´ì¼ ${added}ê°œë¥¼ íœ´ê°•ì¼ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`, "ok");
    });

    // ì»¤ë¦¬í˜ëŸ¼ ì„ íƒ â†’ URL ìë™ ë§¤ì¹­ + ì»¤ìŠ¤í…€ ì½”ìŠ¤ ì „ìš© ì…ë ¥ í‘œì‹œ
    $("curriculumSelect").addEventListener("change", ()=>{
      const v = $("curriculumSelect").value;
      const isCustom = (v === CUSTOM_COURSE_LABEL);
      const isBranding = (v === BRANDING_COURSE_LABEL);
      const isNoLink = isCustom || isBranding;

      $("customCourseBox").style.display = isCustom ? "block" : "none";
      $("curriculumUrl").disabled = isNoLink;

      if(isNoLink){
        $("curriculumUrl").value = "";
      }else{
        const slug = CURRICULUM_MAP[v] || "";
        if(slug) $("curriculumUrl").value = slug;
      }
    });

    $("generate").addEventListener("click", ()=>{
      const res = buildMessage();
      if(!res.ok){
        showAlert(res.error, "warn");
        return;
      }
      $("output").value = res.text;
      showAlert("ë¬¸êµ¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    });

    $("copy").addEventListener("click", async ()=>{
      const r = await copyToClipboard($("output").value);
      if(r.ok) showAlert("ë³µì‚¬ ì™„ë£Œ!", "ok");
      else showAlert("ë³µì‚¬ ì‹¤íŒ¨: í…ìŠ¤íŠ¸ë¥¼ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.", "warn");
    });

    $("reset").addEventListener("click", ()=>{
      $("studentName").value = "";
      $("enrollType").value = "NEW";
      $("familyType").value = "ONLY";
      $("classType").value = "ONE_ON_ONE";
      $("startDay").value = "";
      $("endDay").value = "";
      $("weekday").value = "ì›”";
      $("amPm").value = "ì˜¤ì „";
      $("korTime").value = "";

      $("studentLocation").value = "DOMESTIC";
      $("overseasBox").style.display = "none";
      $("countryInput").value = "";
      $("customFlag").value = "";
      $("dstMode").value = "AUTO";
      $("tzSearch").value = "";
      $("holidayList").textContent = "ì•„ì§ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
      fetchedHolidays = [];

      $("usStateBox").style.display = "none";
      $("usStateSelect").value = "";

      setSelectOptions($("tzSelect"), [], "ì‹œê°„ëŒ€ ì„ íƒ");
      $("output").value = "";
      closedList = [];
      renderClosedPreview();
      updateLocalPreview();

      $("curriculumUrl").value = "";
      $("customCourseName").value = "";
      $("customCourseBox").style.display = "none";
      $("curriculumUrl").disabled = false;

      showAlert("ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    });
  }

  function init(){
    initCurriculumSelect();
    initCountryDatalist();
    initUsStateSelect();
    setSelectOptions($("tzSelect"), [], "ì‹œê°„ëŒ€ ì„ íƒ");
    $("holidayList").textContent = "ì•„ì§ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
    renderClosedPreview();
    bind();
    $("curriculumSelect").dispatchEvent(new Event("change"));
    updateLocalPreview();
  }

  init();
</script>
</body>
</html>
